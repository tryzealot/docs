"use strict";(self.webpackChunkzealot_new_docs=self.webpackChunkzealot_new_docs||[]).push([[8575],{6561:(e,n,o)=>{o.r(n),o.d(n,{assets:()=>a,contentTitle:()=>r,default:()=>p,frontMatter:()=>l,metadata:()=>i,toc:()=>d});var t=o(5893),s=o(1151);const l={sidebar_label:"Step by step"},r="Docker deployment guide",i={id:"self-hosted/deployment/docker/step-by-step",title:"Docker deployment guide",description:"This is a handy guide to deploying with Docker, as well as a breakdown of the on-premise deployment guide.",source:"@site/docs/self-hosted/deployment/docker/step-by-step.md",sourceDirName:"self-hosted/deployment/docker",slug:"/self-hosted/deployment/docker/step-by-step",permalink:"/docs/next/self-hosted/deployment/docker/step-by-step",draft:!1,unlisted:!1,editUrl:"https://github.com/tryzealot/docs/tree/main/docs/self-hosted/deployment/docker/step-by-step.md",tags:[],version:"current",frontMatter:{sidebar_label:"Step by step"},sidebar:"selfHosted",previous:{title:"On-premise (Docker)",permalink:"/docs/next/self-hosted/deployment/docker"},next:{title:"Kubernetes",permalink:"/docs/next/self-hosted/deployment/kubernetes"}},a={},d=[{value:"Versions",id:"versions",level:2},{value:"Registry",id:"registry",level:2},{value:"Step by Step",id:"step-by-step",level:2},{value:"Install Docker",id:"install-docker",level:3},{value:"Install Docker-Compose",id:"install-docker-compose",level:3},{value:"Configure .env file",id:"configure-env-file",level:3},{value:"Configure site domain",id:"configure-site-domain",level:3},{value:"Configure SSL certificate",id:"configure-ssl-certificate",level:3},{value:"Generate docker-compose.yml",id:"generate-docker-composeyml",level:3},{value:"Create docker volumes for persistent storage",id:"create-docker-volumes-for-persistent-storage",level:3},{value:"Pull images",id:"pull-images",level:3},{value:"Setup database data",id:"setup-database-data",level:3},{value:"Launch docker-compose",id:"launch-docker-compose",level:3},{value:"Advanced",id:"advanced",level:2},{value:"Custom volumes",id:"custom-volumes",level:3},{value:"1. Create custom docker volume",id:"1-create-custom-docker-volume",level:4},{value:"2. Change volumes part of docker-compose file",id:"2-change-volumes-part-of-docker-compose-file",level:4},{value:"Complete example",id:"complete-example",level:2}];function c(e){const n={a:"a",blockquote:"blockquote",code:"code",h1:"h1",h2:"h2",h3:"h3",h4:"h4",li:"li",p:"p",pre:"pre",ul:"ul",...(0,s.a)(),...e.components};return(0,t.jsxs)(t.Fragment,{children:[(0,t.jsx)(n.h1,{id:"docker-deployment-guide",children:"Docker deployment guide"}),"\n",(0,t.jsxs)(n.p,{children:["This is a handy guide to deploying with Docker, as well as a breakdown of the ",(0,t.jsx)(n.a,{href:"/docs/self-hosted/deployment/docker",children:"on-premise deployment guide"}),"."]}),"\n",(0,t.jsx)(n.h2,{id:"versions",children:"Versions"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:["Stable version - 5.1.0/latest - ",(0,t.jsx)(n.code,{children:"ghcr.io/tryzealot/zealot:latest"})]}),"\n",(0,t.jsxs)(n.li,{children:["Nightly version - develop - ",(0,t.jsx)(n.code,{children:"ghcr.io/tryzealot/zealot:nightly"})," - Based on branch ",(0,t.jsx)(n.code,{children:"develop"})," builds per commit."]}),"\n"]}),"\n",(0,t.jsx)(n.h2,{id:"registry",children:"Registry"}),"\n",(0,t.jsxs)(n.blockquote,{children:["\n",(0,t.jsxs)(n.p,{children:["Docker hub ",(0,t.jsx)(n.a,{href:"https://web.docker.com/rs/790-SSB-375/images/privatereposfaq.pdf",children:"retrieve free team organizations"}),", zealot image stopped to push new version."]}),"\n"]}),"\n",(0,t.jsxs)(n.p,{children:["Github Container Registry: ",(0,t.jsx)(n.a,{href:"https://github.com/tryzealot/zealot/pkgs/container/zealot",children:"https://github.com/tryzealot/zealot/pkgs/container/zealot"})]}),"\n",(0,t.jsx)(n.h2,{id:"step-by-step",children:"Step by Step"}),"\n",(0,t.jsx)(n.h3,{id:"install-docker",children:"Install Docker"}),"\n",(0,t.jsxs)(n.p,{children:["Follows ",(0,t.jsx)(n.a,{href:"https://get.docker.com/",children:"official tutorial"})," to install docker."]}),"\n",(0,t.jsx)(n.h3,{id:"install-docker-compose",children:"Install Docker-Compose"}),"\n",(0,t.jsxs)(n.p,{children:["Follows ",(0,t.jsx)(n.a,{href:"https://docs.docker.com/compose/install/",children:"official tutorial"})," to install docker-compose."]}),"\n",(0,t.jsx)(n.h3,{id:"configure-env-file",children:"Configure .env file"}),"\n",(0,t.jsxs)(n.p,{children:["Download a sample ",(0,t.jsx)(n.a,{href:"https://github.com/tryzealot/zealot-docker/blob/master/config.env",children:"config.env"})," file and customize it on your own."]}),"\n",(0,t.jsx)(n.h3,{id:"configure-site-domain",children:"Configure site domain"}),"\n",(0,t.jsx)(n.p,{children:"The secondary verification will remind again if it is not configured"}),"\n",(0,t.jsx)(n.h3,{id:"configure-ssl-certificate",children:"Configure SSL certificate"}),"\n",(0,t.jsx)(n.p,{children:"Provides three ways to do this, even if the last one generates the https protocol header:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsx)(n.li,{children:"Using Let's Encrypt SSL"}),"\n",(0,t.jsx)(n.li,{children:"Using Self-signed SSL"}),"\n",(0,t.jsx)(n.li,{children:"Using non-SSL with Zealot service (needs gateway or reverse proxy to manage SSL\uff09"}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"generate-docker-composeyml",children:"Generate docker-compose.yml"}),"\n",(0,t.jsx)(n.p,{children:"The configuration file will generate at least three services, using the first two certificates will add an additional service."}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"zealot-zealot"}),": Use reverse-generation gateway services to deliver core Web and API services"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"zealot-postgres"}),": Database service"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"zealot-redis"}),": Cache service"]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"zealot-web"}),": Provides a reverse proxy gateway service for (services and certificates), optional."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"create-docker-volumes-for-persistent-storage",children:"Create docker volumes for persistent storage"}),"\n",(0,t.jsx)(n.p,{children:"Persistent storage Data:"}),"\n",(0,t.jsxs)(n.ul,{children:["\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"zealot-uploads"}),": Uploaded app file with extracted icon, uploaded debugging files."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"zealot-backup"}),": backup files."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"zealot-postgres"}),": Core database data."]}),"\n",(0,t.jsxs)(n.li,{children:[(0,t.jsx)(n.code,{children:"zealot-redis"}),": Hot cache and background jobs data."]}),"\n"]}),"\n",(0,t.jsx)(n.h3,{id:"pull-images",children:"Pull images"}),"\n",(0,t.jsx)(n.p,{children:"The first time you use it, you will initialize the database,\nload the sample application data and set up the administrator account,\nwhich is required for subsequent zealot updates."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker-compose pull\n"})}),"\n",(0,t.jsx)(n.h3,{id:"setup-database-data",children:"Setup database data"}),"\n",(0,t.jsx)(n.p,{children:"The first time you use it, you will initialize the database, load the sample application data\nand set up the administrator account, which is required for subsequent zealot updates."}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker-compose run --rm zealot run_upgrade\n"})}),"\n",(0,t.jsx)(n.h3,{id:"launch-docker-compose",children:"Launch docker-compose"}),"\n",(0,t.jsx)(n.p,{children:"Manual execution is required to run the service for security periods and user-defined operations:"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-bash",children:"docker-compose up -d\n"})}),"\n",(0,t.jsx)(n.h2,{id:"advanced",children:"Advanced"}),"\n",(0,t.jsx)(n.h3,{id:"custom-volumes",children:"Custom volumes"}),"\n",(0,t.jsx)(n.p,{children:"You have two t"}),"\n",(0,t.jsxs)(n.p,{children:["There are two ways to customize the path: (Assuming that the custom path is ",(0,t.jsx)(n.code,{children:"/data/zealot"}),")"]}),"\n",(0,t.jsx)(n.h4,{id:"1-create-custom-docker-volume",children:"1. Create custom docker volume"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-sh",children:"docker volume create --name zealot-data \\\n  --opt type=none \\\n  --opt o=bind \\\n  --opt device=/data/zealot/zealot-data\n\ndocker volume create --name zealot-redis \\\n  --opt type=none \\\n  --opt o=bind \\\n  --opt device=/data/zealot/redis\n\ndocker volume create --name zealot-postgres \\\n  --opt type=none \\\n  --opt o=bind \\\n  --opt device=/data/zealot/postgres\n"})}),"\n",(0,t.jsx)(n.h4,{id:"2-change-volumes-part-of-docker-compose-file",children:"2. Change volumes part of docker-compose file"}),"\n",(0,t.jsxs)(n.p,{children:["Open ",(0,t.jsx)(n.code,{children:"docker-compose.yml"})," file and find ",(0,t.jsx)(n.code,{children:"volumes:"}),":"]}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:"volumes:\n  zealot-data:\n    driver: local\n    driver_opts:\n      o: bind\n      type: none\n      device: /data/zealot/data\n  zealot-redis:\n    driver: local\n    driver_opts:\n      o: bind\n      type: none\n      device: /data/zealot/redis\n\n  zealot-postgres:\n    driver: local\n    driver_opts:\n      o: bind\n      type: none\n      device: /data/zealot/postgres\n"})}),"\n",(0,t.jsx)(n.h2,{id:"complete-example",children:"Complete example"}),"\n",(0,t.jsx)(n.pre,{children:(0,t.jsx)(n.code,{className:"language-yaml",children:'version: "3.8"\n\nx-restart-policy: &restart_policy\n  restart: unless-stopped\n\nx-defaults: &defaults\n  <<: *restart_policy\n  image: ghcr.io/tryzealot/zealot:nightly\n  depends_on:\n    - redis\n    - postgres\n  env_file: .env\n  volumes:\n    - zealot-uploads:/app/public/uploads\n    - zealot-backup:/app/public/backup\n    - ./log:/app/log                        # Optional: persisting log files.\n  healthcheck:\n    test: ["CMD-SHELL", "wget -q --spider --proxy=off localhost/health || exit 1"]\n\nservices:\n  redis:\n    <<: *restart_policy\n    image: redis:7-alpine\n    command: redis-server\n    volumes:\n      - zealot-redis:/data\n    healthcheck:\n      test: ["CMD", "redis-cli", "ping"]\n  postgres:\n    <<: *restart_policy\n    image: postgres:14-alpine\n    volumes:\n      - zealot-postgres:/var/lib/postgresql/data\n    environment:\n      POSTGRES_PASSWORD: ze@l0t\n    healthcheck:\n      test: ["CMD", "pg_isready", "-U", "postgres"]\n  zealot:\n    <<: *defaults\n    # Port mapping can be enabled without the need for reverse proxy,\n    # mutually exclusive with the web reverse proxy service below.\n    ports:\n      - "80:80"\n  # Optional: Use a reverse proxy to host SSL certificates and services.\n  web:\n    image: caddy:2-alpine\n    ports:\n      - "80:80"\n      - "443:443"\n    volumes:\n      - ./caddy/etc/caddy/Caddyfile:/etc/caddy/Caddyfile:ro\n      - ./caddy/etc/caddy/certs:/etc/caddy/certs:ro\n    env_file: .env\n    environment:\n      ACME_AGREE: "true"\n\n# There are three methods of persistence:\nvolumes:\n  # 1. docker compose inside volumes\n  - zealot-uploads\n  - zealot-backup\n  - zealot-redis\n  - zealot-postgres\n\n  # 2. docker compose external volumes\n  zealot-uploads:\n    external: true\n  zealot-backup:\n    external: true\n  zealot-redis:\n    external: true\n  zealot-postgres:\n    external: true\n\n  # 3. mount local path\n  zealot-uploads:\n    driver: local\n    driver_opts:\n      o: bind\n      type: none\n      device: /tmp/zealot/uploads\n  zealot-backup:\n    driver: local\n    driver_opts:\n      o: bind\n      type: none\n      device: /tmp/zealot/backup\n  zealot-redis:\n    driver: local\n    driver_opts:\n      o: bind\n      type: none\n      device: /tmp/redis\n  zealot-postgres:\n    driver: local\n    driver_opts:\n      o: bind\n      type: none\n      device: /tmp/postgres\n'})})]})}function p(e={}){const{wrapper:n}={...(0,s.a)(),...e.components};return n?(0,t.jsx)(n,{...e,children:(0,t.jsx)(c,{...e})}):c(e)}},1151:(e,n,o)=>{o.d(n,{Z:()=>i,a:()=>r});var t=o(7294);const s={},l=t.createContext(s);function r(e){const n=t.useContext(l);return t.useMemo((function(){return"function"==typeof e?e(n):{...n,...e}}),[n,e])}function i(e){let n;return n=e.disableParentContext?"function"==typeof e.components?e.components(s):e.components||s:r(e.components),t.createElement(l.Provider,{value:n},e.children)}}}]);